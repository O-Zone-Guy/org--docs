#+NAME: get-list
#+BEGIN_SRC python :exports results :results value raw :var ignore_pattern="code_snippets.org"
  import re
  from fnmatch import fnmatch
  from os import listdir
  from os.path import isdir

  SIBLINGS = listdir('.')
  FILES = [f for f in SIBLINGS if fnmatch(f, '[!\.\*]*.org') and re.match(ignore_pattern, f) is None]
  DIRS = [f for f in SIBLINGS if isdir(f)]

  r = re.compile('#\+TITLE: (.*)', re.I)

  lists = ""
  for f in FILES:
      fr = open(f, 'r')
      try:
          lists += " - [[file:" + f + "][" + r.match(fr.read()).group(1) + "]]\n"
          # lists +=  r.match(fr.read()).group(1) + "\n"
      except:
          pass

  for d in DIRS:
      f = d + "/" + d + ".org"
      try:
          with open(f, 'r') as fr:
              lists += " - [[file:" + f + "][" + r.match(fr.read()).group(1) + "]]\n"
      except:
          pass
  return lists
#+END_SRC
